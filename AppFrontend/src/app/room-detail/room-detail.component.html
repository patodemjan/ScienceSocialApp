<header [style.backgroundImage]="'url(/assets/titlePic.webp)'">
  <h1>{{ room?.name }}</h1>
</header>

<div class="buttons-top">
  <button (click)="goToRooms()" class="buttons">Rooms</button>
  <button (click)="signOut()" *ngIf="isLoggedIn" class="buttons">Sign Out</button>
</div>

<div class="tabs">
  <button [class.active]="selectedTab==='chat'" (click)="selectTab('chat')">Chat</button>
  <button [class.active]="selectedTab==='topic'" (click)="selectTab('topic')">Topic</button>
  <button [class.active]="selectedTab==='list'" (click)="selectTab('list')">List of Topics</button>
</div>

<div class="tab-content">

  <!-- CHAT -->
  <div *ngIf="selectedTab==='chat'" id="chat">
    <div class="chat-input">
      <input id="chatInput" [(ngModel)]="newChatMessage" [disabled]="!canChat()" placeholder="Type a message...">
      <button id="send" (click)="sendChatMessage()" [disabled]="!canChat()">Send</button>
    </div>

    <div class="chat-window">
      <div *ngFor="let post of chatPosts" class="chat-post">
        <div class="chat-header">
          <span class="author">{{ post.authorUsername }}</span>
          <span class="time">{{ post.createdAt | date:'short' }}</span>
        </div>
        <p class="chat-content">{{ post.content }}</p>
      </div>
    </div>
  </div>

  <!-- LIST OF TOPICS -->
  <div *ngIf="selectedTab==='list'" id="topicList">
    <div class="chat-input search-bar">
      <input class="topic-input" #searchInput placeholder="Search topic..." />
      <button class="topic-button" (click)="searchTopic(searchInput.value)">Search</button>
      <button class="topic-button" (click)="viewAllTopics()">View All Topics</button>
    </div>
    <ul>
      <li *ngFor="let topic of displayedTopics" (click)="openTopic(topic)">
        {{ topic.title }}
      </li>
    </ul>
  </div>

  <!-- TOPIC DETAIL -->
  <div *ngIf="selectedTab==='topic' && selectedTopic" id="topic">
    <h2>{{ selectedTopic.title }}</h2>

    <div class="chat-input">
      <input class="topic-input" #postInput [disabled]="!isLoggedIn" placeholder="Add comment..." />
      <button class="topic-button" (click)="addComment(selectedTopic, postInput.value); postInput.value=''" [disabled]="!isLoggedIn">Add Comment</button>
    </div>

    <div class="posts">
      <div *ngFor="let post of selectedTopic.posts" class="post">
        <div class="topic-header">
          <span class="author">{{ post.authorUsername }}</span>
          <span class="time">{{ post.createdAt | date:'short' }}</span>
        </div>

        <ng-container *ngIf="isMediaLink(post.content)">
          <iframe *ngIf="isYouTube(post.content)" width="300" height="200"
                  [src]="getSafeUrl(post.content)" frameborder="0" allowfullscreen>
          </iframe>
          <img *ngIf="isImage(post.content)" [src]="post.content" width="300" height="200"/>
        </ng-container>

        <p class="topic-content" *ngIf="!isMediaLink(post.content)">
          {{ post.content }}
        </p>
      </div>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="footeritems">
    <a (click)="navigateTo('/mainpage/home')">home</a>
    <a (click)="navigateTo('/mainpage/about')">about us</a> 
    <a (click)="navigateTo('/mainpage/rooms')">rooms</a>
    <a (click)="navigateTo('/mainpage/contact')">contact</a>
    <a *ngIf="!isLoggedIn" (click)="navigateTo('/login')">sign in</a>
    <a *ngIf="isLoggedIn" (click)="signOut()">sign out</a>
  </div>

  <div class="footeritems">
    <a (click)="navigateTo('/help')">help</a>
    <a (click)="navigateTo('/faq')">faq</a>
    <a (click)="navigateTo('/cookies')">cookies</a>
    <a (click)="navigateTo('/impressum')">impressum</a>
  </div>

  <div class="footeritems">
    <a href="https://www.linkedin.com/in/patrik-demjan-90602429b/" target="_blank">
      <i class="fab fa-linkedin"></i> LinkedIn
    </a>
    <a href="https://github.com/patodemjan/" target="_blank">
      <i class="fab fa-github"></i> GitHub
    </a>
    <a href="mailto:patodemjan@gmail.com">
      <i class="fas fa-envelope"></i> Email
    </a>
    <a href="https://patodemjan.github.io/Portfolio/" target="_blank">
      <i class="fas fa-briefcase"></i> Portfolio
    </a>
  </div>

  <span id="allrights">
    <p>Â© 2025 Patrik Demjan. All rights reserved.</p>
  </span>
</footer>
